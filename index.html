<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8"> <!-- 设置字符编码为UTF-8 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- 使网页在移动设备上适应屏幕宽度 -->
    <title>历史记录计算器 - Kevin鲁大师</title> <!-- 网页标题 -->
    <style>
        /* Global Styles */
        body {
            font-family: 'Roboto', sans-serif; /* 设置全局字体 */
            background-color: #767676; /* 设置页面背景颜色 */
            margin: 0; /* 移除页面默认边距 */
            padding: 0; /* 移除页面默认内边距 */
            height: 100vh; /* 使页面高度为视口高度 */
            display: flex; /* 使用Flexbox布局 */
            justify-content: center; /* 在水平上居中内容 */
            align-items: center; /* 在垂直上居中内容 */
            color: #333; /* 设置文字颜色 */
            overflow: hidden; /* 防止页面溢出 */
        }

        .calculator {
            background-color: #2c2c2c; /* 设置计算器背景颜色 */
            border-radius: 20px; /* 设置计算器的圆角边框 */
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3); /* 设置计算器的阴影效果 */
            padding: 20px; /* 设置内边距 */
            width: 100%; /* 设置宽度为100% */
            max-width: 900px;  /* 限制最大宽度为 900px */
            min-width: 280px;  /* 限制最小宽度 */
            text-align: center; /* 设置文本对齐方式为居中 */
            box-sizing: border-box; /* 包括边框和内边距在内的总宽度和高度 */
        }

        .calculator h1 {
            font-size: 28px; /* 设置标题字体大小 */
            margin-bottom: 20px; /* 设置标题底部的外边距 */
            color: #fff; /* 设置标题字体颜色 */
        }

        /* Updated textarea styling */
        textarea {
            width: 100%; /* 宽度占满父元素 */
            padding: 15px; /* 内边距 */
            font-size: 24px; /* 字体大小 */
            border-radius: 10px; /* 圆角边框 */
            border: 1px solid #444; /* 边框颜色 */
            text-align: right; /* 文本右对齐 */
            margin-bottom: 20px; /* 底部外边距 */
            background-color: #333; /* 背景颜色 */
            color: white; /* 文字颜色 */
            box-sizing: border-box; /* 包括边框和内边距在内的总宽度和高度 */
            resize: none; /* 禁止调整大小 */
            overflow-wrap: break-word; /* 超出时换行 */
            word-wrap: break-word; /* 换行方式 */
            height: auto; /* 自适应高度 */
            min-height: 60px; /* 设置最小高度 */
        }

        textarea:focus {
            background-color: #444; /* 聚焦时改变背景颜色 */
            outline: none; /* 去掉聚焦时的轮廓 */
        }

        button {
            width: 60px; /* 按钮宽度 */
            height: 60px; /* 按钮高度 */
            margin: 8px; /* 按钮外边距 */
            font-size: 20px; /* 字体大小 */
            border-radius: 50%; /* 圆形按钮 */
            border: none; /* 去掉边框 */
            background-color: #3e3e3e; /* 按钮背景色 */
            color: #fff; /* 按钮字体颜色 */
            cursor: pointer; /* 鼠标悬停时显示为点击手势 */
            transition: transform 0.2s, background-color 0.3s ease; /* 设置按钮的过渡效果 */
        }

        button:hover {
            background-color: #5c5c5c; /* 鼠标悬停时背景颜色 */
            transform: scale(1.1); /* 鼠标悬停时放大按钮 */
        }

        button:active {
            background-color: #1f1f1f; /* 鼠标点击时背景颜色 */
            transform: scale(0.98); /* 鼠标点击时缩小按钮 */
        }

        .footer {
            font-size: 13px; /* 设置页脚文字的大小 */
            margin-top: 20px; /* 设置页脚的上边距 */
            color: #bfbfbf; /* 设置页脚文字的颜色 */
            position: relative; /* 确保它在布局中显示 */
            z-index: 10; /* 确保它在其他内容上方 */
            padding-bottom: 20px; /* 给底部留出空间 */
        }

        .footer p {
            margin: 0; /* 去掉页脚文字的默认外边距 */
        }

        /* Additional Button Styling for Functional Buttons */
        .button-clear {
            background-color: #d9534f; /* 清除按钮的背景颜色 */
        }

        .button-equal {
            background-color: #5bc0de; /* 等于按钮的背景颜色 */
            border-radius: 20px; /* 圆角长方形 */
            width: 270px; /* 宽度为3个普通按钮的宽度 */
            height: 60px; /* 高度与普通按钮相同 */
            grid-column: span 3; /* 横跨3个格子 */
        }

        .operator-button {
            background-color: #ff8c00; /* 运算符的背景色 */
        }

        .operator-button:hover {
            background-color: #e57e00; /* 运算符按钮的 hover 效果 */
        }

        .operator-button:active {
            background-color: #b36900; /* 运算符按钮的点击效果 */
        }

        .button-plus {
            width: 60px; /* 恢复加号按钮为普通宽度 */
            background-color: #28a745; /* 特殊背景颜色 */
        }

        .button-plus:hover {
            background-color: #218838; /* 加号按钮 hover 效果 */
        }

        .button-plus:active {
            background-color: #1e7e34; /* 加号按钮点击效果 */
        }

        .button-percent {
            background-color: #ffc107; /* 百分号按钮背景色 */
        }

        .button-percent:hover {
            background-color: #e0a800; /* 百分号按钮 hover 效果 */
        }

        .button-percent:active {
            background-color: #c69500; /* 百分号按钮点击效果 */
        }

        /* Grid Layout for Buttons */
        .button-group {
            display: grid; /* 使用Grid布局 */
            grid-template-columns: repeat(4, 1fr); /* 设置4列等宽格子 */
            gap: 10px; /* 设置按钮之间的间距 */
            margin-bottom: 20px; /* 底部外边距 */
        }

        /* History Section */
        .history {
            margin-top: 20px; /* 设置历史记录区域的上边距 */
            background-color: #444; /* 设置历史记录背景颜色 */
            padding: 10px; /* 内边距 */
            border-radius: 10px; /* 圆角边框 */
            max-height: 200px; /* 最大高度限制 */
            overflow-y: auto; /* 如果内容超出则出现滚动条 */
            color: #fff; /* 设置历史记录文字颜色 */
        }

        .history-item {
            margin-bottom: 10px; /* 设置每个历史记录项的下边距 */
            font-size: 14px; /* 设置历史记录项的字体大小 */
        }

        .calculator {
            max-width: 100%; /* 计算器宽度最大为100% */
            max-height: 100%; /* 计算器高度最大为100% */
            padding: 20px; /* 内边距 */
        }

        /* Media Queries for Responsiveness */
        @media (max-width: 480px) {
            textarea {
                font-size: 20px; /* 调整字体大小 */
                padding: 12px; /* 调整内边距 */
            }

            button {
                width: 50px; /* 调整按钮大小 */
                height: 50px; /* 调整按钮大小 */
                font-size: 18px; /* 调整按钮字体大小 */
            }

            .calculator {
                width: 90%; /* 使计算器宽度适应小屏幕 */
                padding: 15px; /* 调整内边距 */
            }

            .button-group {
                grid-template-columns: repeat(4, 1fr); /* 设置4列 */
                gap: 8px; /* 调整按钮间距 */
            }
        }

        @media (max-width: 768px) {
            .calculator {
                width: 90%; /* 使计算器宽度适应屏幕 */
                padding: 20px; /* 内边距 */
            }

            textarea {
                font-size: 22px; /* 调整字体大小 */
                padding: 14px; /* 内边距 */
            }

            button {
                width: 55px; /* 调整按钮大小 */
                height: 55px; /* 调整按钮大小 */
                font-size: 18px; /* 调整按钮字体大小 */
            }
        }
    </style>
</head>
<body>

    <!-- 计算器容器 -->
    <div class="calculator">
        <h1>历史记录计算器</h1> <!-- 标题 -->
        <textarea id="display" disabled placeholder="0"></textarea> <!-- 显示区，输入和结果显示 -->

        <!-- 按钮组 -->
        <div class="button-group">
            <!-- 清除按钮、括号按钮、退格按钮、百分号按钮 -->
            <button class="button-clear" onclick="clearDisplay()">×</button>
            <button class="operator-button" onclick="appendToDisplay('(')">(</button>
            <button class="operator-button" onclick="appendToDisplay(')')">)</button>
            <button class="operator-button" onclick="deleteLastCharacter()">⌫</button>

            <!-- 数字按钮和运算符按钮 -->
            <button onclick="appendToDisplay('7')">7</button>
            <button onclick="appendToDisplay('8')">8</button>
            <button onclick="appendToDisplay('9')">9</button>
            <button class="operator-button" onclick="appendToDisplay('/')">/</button>

            <button onclick="appendToDisplay('4')">4</button>
            <button onclick="appendToDisplay('5')">5</button>
            <button onclick="appendToDisplay('6')">6</button>
            <button class="operator-button" onclick="appendToDisplay('*')">*</button>

            <button onclick="appendToDisplay('1')">1</button>
            <button onclick="appendToDisplay('2')">2</button>
            <button onclick="appendToDisplay('3')">3</button>
            <button class="operator-button" onclick="appendToDisplay('-')">-</button>

            <button onclick="appendToDisplay('00')">00</button>
            <button onclick="appendToDisplay('0')">0</button>
            <button onclick="appendToDisplay('.')">.</button>
            <button class="button-plus" onclick="appendToDisplay('+')">+</button>

            <!-- 等号按钮 -->
            <button class="button-equal" onclick="calculateResult()">=</button>

            <!-- 百分号按钮 -->
            <button class="button-percent" onclick="calculatePercentage()">%</button>
        </div>

        <!-- 历史记录区域 -->
        <div class="history">
            <h2>历史记录</h2>
            <div id="history-list"></div> <!-- 显示历史记录的列表 -->
            <button onclick="clearAllHistory()">×</button> <!-- 清空历史记录 -->
            <button onclick="clearLastHistory()">←</button> <!-- 删除最后一条历史记录 -->
            <button onclick="undoLastDeleted()">○</button> <!-- 撤销删除历史记录 -->
        </div>

        <!-- 页脚 -->
        <div class="footer">
            <p>制作人：Kevin鲁大师 【仅供个人学习交流  请勿商业用途】</p>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        let history = []; // 用于存储历史记录
        let previousCalculation = null;  // 用于存储上一次计算的公式
        let lastDeletedHistory = null;  // 用于存储最后删除的历史记录

        // 将点击的按钮值添加到显示框中
        function appendToDisplay(value) {
            let display = document.getElementById('display');
            let currentInput = display.value;
            if (currentInput === '0') { // 如果显示框是0，则清空
                currentInput = '';
            }
            display.value = currentInput + value; // 将当前值添加到显示框
        }

        // 清空显示框
        function clearDisplay() {
            let display = document.getElementById('display');
            display.value = '0'; // 重置为0
        }

        // 删除最后一个字符
        function deleteLastCharacter() {
            let display = document.getElementById('display');
            let currentInput = display.value;
            display.value = currentInput.slice(0, -1) || '0'; // 删除最后一个字符，若为空则显示0
        }

        // 计算结果并显示
        function calculateResult() {
            let display = document.getElementById('display');
            let currentInput = display.value;
            try {
                let result = eval(currentInput); // 计算公式结果
                let record = `${currentInput} = ${result}`; // 格式化公式和结果
                previousCalculation = currentInput;
                history.push(record); // 将计算结果添加到历史记录中
                updateHistory(); // 更新历史记录显示
                display.value = result; // 显示计算结果
            } catch (error) {
                display.value = '错误'; // 如果公式错误，则显示'错误'
            }
        }

        // 计算百分比
        function calculatePercentage() {
            let display = document.getElementById('display');
            let currentInput = display.value;
            try {
                currentInput = (eval(currentInput) / 100).toString(); // 将结果除以100
                display.value = currentInput;
            } catch (error) {
                display.value = '错误'; // 计算错误时显示'错误'
            }
        }

        // 更新历史记录显示
        function updateHistory() {
            const historyList = document.getElementById('history-list');
            historyList.innerHTML = ''; // 清空历史记录区域
            history.forEach(item => {
                const div = document.createElement('div'); // 创建新的div元素
                div.classList.add('history-item'); // 为div添加类
                div.textContent = item; // 设置div的文本为历史记录项
                historyList.appendChild(div); // 将div添加到历史记录区域
            });
        }

        // 清空所有历史记录
        function clearAllHistory() {
            history = []; // 清空历史记录数组
            lastDeletedHistory = null; // 清空撤销记录
            updateHistory(); // 更新历史记录显示
        }

        // 删除最后一条历史记录
        function clearLastHistory() {
            lastDeletedHistory = history.pop(); // 将最后一条历史记录保存到撤销记录中
            updateHistory(); // 更新历史记录显示
        }

        // 撤销删除最后一条历史记录
        function undoLastDeleted() {
            if (lastDeletedHistory !== null) { // 如果有历史记录可以撤销
                history.push(lastDeletedHistory); // 恢复删除的历史记录
                updateHistory(); // 更新历史记录显示
                lastDeletedHistory = null; // 清除撤销记录
            }
        }
    </script>
</body>
</html>
